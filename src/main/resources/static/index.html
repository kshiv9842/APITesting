<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>cURL Parser & API Tester</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 150px; }
        #executeBtn:disabled { background-color: #ccc; cursor: not-allowed; }
        #logs { white-space: pre-wrap; background: #f4f4f4; padding: 10px; height: 300px; overflow-y: scroll; border: 1px solid #ddd; }
        .warning { color: red; }
    </style>
</head>
<body>
    <h1>cURL Parser & API Tester</h1>
    <p class="warning">Prerequisite: Make sure the cURL API has been first hit via Postman.</p>

    <textarea id="curlInput" placeholder="Enter your cURL command here..."></textarea>
    <br><br>
    <button id="executeBtn" disabled>Execute</button>

    <h2>Results</h2>
    <div id="logs"></div>

    <script>
        const curlInput = document.getElementById("curlInput");
        const executeBtn = document.getElementById("executeBtn");
        const logs = document.getElementById("logs");

        function appendLog(message) {
            logs.textContent += message + "\n";
            logs.scrollTop = logs.scrollHeight;
        }

        // Validate input and enable button only if starts with "curl --location "
        curlInput.addEventListener("input", () => {
            if (curlInput.value.trim().startsWith("curl --location ")) {
                executeBtn.disabled = false;
            } else {
                executeBtn.disabled = true;
            }
        });

        executeBtn.addEventListener("click", async () => {
            const curlCommand = curlInput.value.trim();
            if (!curlCommand.startsWith("curl --location ")) {
                appendLog("❌ Invalid cURL format. Must start with: curl --location");
                return;
            }

            executeBtn.disabled = true; // disable until response
            appendLog("=== Executing cURL ===\n" + curlCommand);

            try {
                const response = await fetch("/api/execute-curl", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain" },
                    body: curlCommand
                });

                const text = await response.text();
                appendLog("=== Response ===\n" + text);
            } catch (err) {
                appendLog("❌ Error: " + err.message);
            } finally {
                executeBtn.disabled = false; // re-enable button
            }
        });
    </script>
</body>
</html>
