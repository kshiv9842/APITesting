<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Curl Executor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container my-5">
    <h2 class="mb-4 text-center">Curl Executor Tool</h2>

    <!-- Input box -->
    <textarea id="curlInput" class="form-control mb-3" rows="4"
              placeholder="Enter curl command here..."></textarea>

    <!-- Execute button -->
    <button onclick="executeCurl()" class="btn btn-primary mb-4">Execute</button>

    <!-- Results section -->
    <div id="resultsAccordion" class="accordion"></div>
</div>

<script>
    async function executeCurl() {
        const curlCommand = document.getElementById("curlInput").value;

        const response = await fetch("/api/execute-curl", {
            method: "POST",
            headers: {"Content-Type": "text/plain"},
            body: curlCommand
        });

        const resultText = await response.text();

        // Split logs when they start with "=== Running"
        const sections = resultText
            .split(/(?=^=== Running)/m)   // keep the "=== Running" line
            .filter(s => s.trim().length > 0);

        const accordion = document.getElementById("resultsAccordion");
        accordion.innerHTML = ""; // clear old results

        sections.forEach((section, index) => {
            const headerId = `heading${index}`;
            const collapseId = `collapse${index}`;
            const title = section.split("\n")[0].replace("=== ", "").trim(); // first line as title

            accordion.innerHTML += `
              <div class="accordion-item">
                <h2 class="accordion-header" id="${headerId}">
                  <button class="accordion-button ${index !== 0 ? "collapsed" : ""}"
                          type="button" data-bs-toggle="collapse"
                          data-bs-target="#${collapseId}"
                          aria-expanded="${index === 0}"
                          aria-controls="${collapseId}">
                    ${title || `Test Case ${index + 1}`}
                  </button>
                </h2>
                <div id="${collapseId}" class="accordion-collapse collapse ${index === 0 ? "show" : ""}"
                     aria-labelledby="${headerId}" data-bs-parent="#resultsAccordion">
                  <div class="accordion-body">
                    <pre>${section.trim()}</pre>
                  </div>
                </div>
              </div>
            `;
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
